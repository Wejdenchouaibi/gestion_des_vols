<div class="container mt-5">
  <!-- Header -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <img src="assets/logo Tunisair.png" alt="Tunisair" style="height: 50px" />
    <div>
      <span *ngIf="user" class="me-3">Bienvenue, {{ user.firstName }} {{ user.lastName }}</span>
      <button class="btn btn-outline-primary" (click)="user ? logout() : login()"> {{ user ? 'Déconnexion' : 'Connexion' }}</button>
    </div>
  </div>

  <!-- Promotions Section -->
  <section class="promotions-section">
    <div class="promotions-container">
      <h3>Promotions / Vols populaires</h3>
      <div class="promotions-grid">
        <div class="promotion-card" *ngFor="let promotion of promotions">
          <div class="promotion-image">
            <img [src]="promotion.image" [alt]="promotion.destination">
            <div class="promotion-badge">
              <span class="discount">{{ promotion.discount }}%</span>
            </div>
          </div>
          <div class="promotion-content">
            <h4>{{ promotion.destination }}</h4>
            <p class="promotion-description">{{ promotion.description }}</p>
            <div class="promotion-price">
              <span class="old-price">{{ promotion.oldPrice | currency:'EUR':'symbol':'1.0-0' }}</span>
              <span class="new-price">{{ promotion.newPrice | currency:'EUR':'symbol':'1.0-0' }}</span>
            </div>
            <button class="btn btn-promotion" (click)="selectPromotion(promotion)">
              Réserver maintenant
            </button>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Reservation Form -->
  <section class="reservation-section mt-5" *ngIf="selectedFlight">
    <h3>{{ isEditing ? 'Modifier la Réservation' : 'Créer une Réservation' }}</h3>
    <form #reservationForm="ngForm" (ngSubmit)="isEditing ? updateReservation() : createReservation()">
      <div class="card mb-3">
        <div class="card-body">
          <h5>Détails du Vol</h5>
          <p>
            ✈️ {{ selectedFlight.departure }} → {{ selectedFlight.arrival }} 
            le {{ selectedFlight.schedule | date: 'dd/MM/yyyy' }} 
            (Prix: {{ selectedFlight.price }} | Classe: {{ selectedFlight.class }} | 
            Compagnie: {{ selectedFlight.company }} | Durée: {{ selectedFlight.duration }}h | 
            Escales: {{ selectedFlight.escales }})
          </p>
        </div>
      </div>
      <div class="row">
        <div class="col-md-3">
          <label for="passengers">Nombre de passagers :</label>
          <input type="number" id="passengers" name="passengers" [(ngModel)]="reservation.passengers"
                 class="form-control" min="1" required />
        </div>
        <div class="col-md-3">
          <label for="class">Classe :</label>
          <select id="class" name="class" [(ngModel)]="reservation.class" class="form-control" required>
            <option value="economique">Économique</option>
            <option value="business">Business</option>
            <option value="premiere">Première</option>
          </select>
        </div>
      </div>
      <div class="mt-3">
        <button type="submit" class="btn btn-primary me-2">
          {{ isEditing ? 'Modifier la Réservation' : 'Confirmer la Réservation' }}
        </button>
        <button type="button" class="btn btn-danger" *ngIf="isEditing" (click)="cancelReservation()">
          Annuler la Réservation
        </button>
        <button type="button" class="btn btn-secondary" (click)="selectedFlight = null">
          Changer de Vol
        </button>
      </div>
    </form>
  </section>

  <!-- Manual Reservation Form when no flight selected -->
  <section class="reservation-section mt-5" *ngIf="!selectedFlight">
    <h3>Créer une Réservation (Manuelle)</h3>
    <form #manualReservationForm="ngForm" (ngSubmit)="createReservation()">
      <div class="card mb-3">
        <div class="card-body">
          <div class="row">
            <div class="col-md-4">
              <label for="flight_id">ID du Vol :</label>
              <input type="text" id="flight_id" name="flight_id" [(ngModel)]="reservation.flight_id" class="form-control" required />
            </div>
            <div class="col-md-4">
              <label for="passengers">Nombre de passagers :</label>
              <input type="number" id="passengers" name="passengers" [(ngModel)]="reservation.passengers" class="form-control" min="1" required />
            </div>
            <div class="col-md-4">
              <label for="class">Classe :</label>
              <select id="class" name="class" [(ngModel)]="reservation.class" class="form-control" required>
                <option value="economique">Économique</option>
                <option value="business">Business</option>
                <option value="premiere">Première</option>
              </select>
            </div>
          </div>
        </div>
      </div>
      <div class="mt-3">
        <button type="submit" class="btn btn-primary me-2">Confirmer la Réservation</button>
  <button type="button" class="btn btn-secondary" (click)="reservation = { flight_id: '', passengers: 1, class: 'economique', passengers_details: [{ name: '', passport_number: '' }] }">Réinitialiser</button>
      </div>
    </form>
  </section>

  <!-- Navigation Links -->
  <div class="mt-4">
    <h4>Autres services :</h4>
    <a routerLink="/search-flight" class="btn btn-info me-2">Rechercher un Vol</a>
    <a routerLink="/user/dashboard" class="btn btn-info">Espace Personnel</a>
  </div>
</div>